<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cherry Hills Missions Globe</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.95/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.95/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        /* Brandon Grotesque Font */
        @font-face {
            font-family: 'Brandon Grotesque';
            src: url('assets/fonts/BrandonGrotesque-Regular.woff2') format('woff2'),
                url('assets/fonts/BrandonGrotesque-Regular.woff') format('woff');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'Brandon Grotesque';
            src: url('assets/fonts/BrandonGrotesque-Medium.woff2') format('woff2'),
                url('assets/fonts/BrandonGrotesque-Medium.woff') format('woff');
            font-weight: 500;
            font-style: normal;
        }

        @font-face {
            font-family: 'Brandon Grotesque';
            src: url('assets/fonts/BrandonGrotesque-Bold.woff2') format('woff2'),
                url('assets/fonts/BrandonGrotesque-Bold.woff') format('woff');
            font-weight: 600;
            font-style: normal;
        }

        @font-face {
            font-family: 'Brandon Grotesque';
            src: url('assets/fonts/BrandonGrotesque-Black.woff2') format('woff2'),
                url('assets/fonts/BrandonGrotesque-Black.woff') format('woff');
            font-weight: 700;
            font-style: normal;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Brandon Grotesque', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            overflow: hidden;
            background: #000;
            color: #fff;
            user-select: none;
            -webkit-user-select: none;
            cursor: default;
            font-weight: 400;
        }

        #cesiumContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #instructions {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            max-width: 300px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        #instructions h2 {
            font-family: 'Brandon Grotesque', sans-serif;
            font-size: 20px;
            margin-bottom: 15px;
            color: #4A90E2;
            font-weight: 600;
        }

        #instructions p {
            font-family: 'Brandon Grotesque', sans-serif;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 10px;
            color: #ddd;
            font-weight: 400;
        }

        #home-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #4A90E2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-family: 'Brandon Grotesque', sans-serif;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        }

        #home-button:hover {
            background: #357ABD;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
        }

        #content-frame {
            position: absolute;
            top: 0;
            left: 100%;
            width: 100%;
            height: 100%;
            background: white;
            transition: left 0.5s ease;
            z-index: 2000;
        }

        #content-frame.active {
            left: 0;
        }

        #back-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #4A90E2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-family: 'Brandon Grotesque', sans-serif;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            z-index: 2001;
            transition: all 0.3s ease;
            display: none;
        }

        #back-button:hover {
            background: #357ABD;
            transform: translateY(-2px);
        }

        #content-frame.active #back-button {
            display: block;
        }

        #content-display {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            padding: 20px;
            color: #333;
            background: #f5f5f5;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Brandon Grotesque', sans-serif;
            font-size: 24px;
            font-weight: 500;
            color: #4A90E2;
        }

        .logo {
            width: 150px;
            height: auto;
            margin-bottom: 20px;
        }

        /* Hide Cesium UI elements for kiosk mode */
        .cesium-viewer-toolbar,
        .cesium-viewer-animationContainer,
        .cesium-viewer-timelineContainer,
        .cesium-viewer-bottom,
        .cesium-viewer-fullscreenContainer,
        .cesium-viewer-vrContainer,
        .cesium-viewer-geocoderContainer,
        .cesium-viewer-homeButton,
        .cesium-viewer-sceneModePicker,
        .cesium-viewer-projectionPicker,
        .cesium-viewer-baseLayerPicker,
        .cesium-viewer-navigationHelpButton,
        .cesium-viewer-infoBoxContainer {
            display: none !important;
        }

        .cesium-selection-wrapper {
            display: none !important;
        }

        /* Custom info box */
        .mission-info-box {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 8px;
            max-width: 300px;
            pointer-events: none;
            z-index: 100;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .mission-info-box h3 {
            font-family: 'Brandon Grotesque', sans-serif;
            color: #4A90E2;
            margin-bottom: 8px;
            font-size: 16px;
            font-weight: 600;
        }

        .mission-info-box p {
            font-family: 'Brandon Grotesque', sans-serif;
            color: #ddd;
            font-size: 14px;
            line-height: 1.4;
            font-weight: 400;
        }
    </style>
</head>

<body>
    <div id="cesiumContainer"></div>

    <div id="instructions">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 60'%3E%3Ctext x='10' y='40' font-family='Arial, sans-serif' font-size='24' font-weight='bold' fill='%234A90E2'%3ECH Missions%3C/text%3E%3C/svg%3E"
            alt="Logo" class="logo">
        <h2>How to Use</h2>
        <p>üåç <strong>Rotate Globe:</strong> Click and drag to explore</p>
        <p>üîç <strong>Zoom:</strong> Scroll or right-click drag</p>
        <p>üìç <strong>View Mission:</strong> Click on any pin</p>
        <p>üè† <strong>Reset View:</strong> Click Home button</p>
    </div>

    <button id="home-button">üè† Home</button>

    <div id="content-frame">
        <button id="back-button">‚Üê Return to Map</button>
        <div id="content-display">
            <div class="loading">Loading mission information...</div>
        </div>
    </div>

    <div class="mission-info-box" id="missionInfoBox">
        <h3 id="missionName"></h3>
        <p>Click to view details</p>
    </div>

    <script>
        // Set Cesium Ion access token
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2ZmYxYzgzMi1jMjI0LTRiYWUtYjcyNS1jYTlkZWI4MThhNTEiLCJpZCI6MzIwMTI0LCJpYXQiOjE3NTMzMTg3NDd9.NJ7AlxH_emAHLiDuIA5Uv6khpP6gDHB_zEPTWABcLcM';

        // Mission data
        const missions = [
            {
                "name": "Nate and Insa Brewer",
                "lat": 48.210033,
                "lng": 16.363449,
                "url": "https://www.cherryhillsfamily.org/missions/global/profile/nate-and-insa-brewer"
            },
            {
                "name": "The James Project",
                "lat": 39.7896428394095,
                "lng": -89.70436802808422,
                "url": "https://cherryhillsfamily.org/missions/local/profile/the-james-project"
            },
            {
                "name": "Enos Elementary School",
                "lat": 39.81371275227684,
                "lng": -89.66123412161984,
                "url": "https://cherryhillsfamily.org/missions/local/profile/enos-elementary-school"
            },
            {
                "name": "First Step Womens Center",
                "lat": 39.81614343832645,
                "lng": -89.64804609100652,
                "url": "https://cherryhillsfamily.org/missions/local/profile/first-step-women-s-center"
            },
            {
                "name": "Washington Street Mission",
                "lat": 39.80539890563301,
                "lng": -89.65046838235627,
                "url": "https://cherryhillsfamily.org/missions/local/profile/washington-street-mission"
            },
            {
                "name": "St. Johns Breadline",
                "lat": 39.8060442514894,
                "lng": -89.650741810007,
                "url": "https://cherryhillsfamily.org/missions/local/profile/st-john-s-breadline"
            },
            {
                "name": "Contact Ministries",
                "lat": 39.800041674513665,
                "lng": -89.64072212591212,
                "url": "https://cherryhillsfamily.org/missions/local/profile/contact-ministries"
            },
            {
                "name": "Powerlight Fest",
                "lat": 39.78186784059419,
                "lng": -89.64999534227154,
                "url": "https://cherryhillsfamily.org/missions/local/profile/powerlight-fest"
            },
            {
                "name": "Fellowship of Christian Athletes",
                "lat": 39.72721028580847,
                "lng": -89.6431716193549,
                "url": "https://cherryhillsfamily.org/missions/local/profile/fellowship-of-christian-athletes"
            },
            {
                "name": "Refuge Ranch",
                "lat": 39.6637119935077,
                "lng": -89.48772737421496,
                "url": "https://cherryhillsfamily.org/missions/local/profile/refuge-ranch"
            },
            {
                "name": "Matt and Nadia Lohse",
                "lat": 41.839973864619175,
                "lng": -87.62502145653507,
                "url": "https://cherryhillsfamily.org/missions/regional/profile/matt-and-nadia-lohse"
            },
            {
                "name": "TJ & Emily Lemons",
                "lat": 40.488271457701906,
                "lng": -88.96748973545199,
                "url": "https://cherryhillsfamily.org/missions/regional/profile/tj-and-emily-lemons"
            },
            {
                "name": "Bryan & Jonell McKenzie",
                "lat": 40.62884600140587,
                "lng": -89.40329365428762,
                "url": "https://cherryhillsfamily.org/missions/regional/profile/bryan-and-jonell-mckenzie"
            },
            {
                "name": "Bill & Sandi Graf",
                "lat": 34.53500017176638,
                "lng": -105.87621306123053,
                "url": "https://cherryhillsfamily.org/missions/global/profile/bill-and-sandi-graf"
            },
            {
                "name": "Amigos en Cristo",
                "lat": 31.691964154431243,
                "lng": -106.4245255578534,
                "url": "https://cherryhillsfamily.org/missions/global/profile/amigos-en-cristo"
            },
            {
                "name": "Greg & Vicki Syverson",
                "lat": 20.099457434634093,
                "lng": -98.7595967600226,
                "url": "https://cherryhillsfamily.org/missions/global/profile/greg-and-vicki-syverson"
            }
        ];

        // Initialize Cesium viewer
        const viewer = new Cesium.Viewer('cesiumContainer', {
            animation: false,
            baseLayerPicker: false,
            fullscreenButton: false,
            geocoder: false,
            homeButton: false,
            sceneModePicker: false,
            selectionIndicator: false,
            timeline: false,
            navigationHelpButton: false,
            vrButton: false,
            scene3DOnly: true,
            automaticallyTrackDataSourceClocks: false,
            shadows: true,
            shouldAnimate: true
        });

        // Configure atmosphere and lighting
        viewer.scene.globe.enableLighting = true;
        viewer.scene.globe.showGroundAtmosphere = true;
        viewer.scene.fog.enabled = false;
        viewer.scene.skyAtmosphere.show = true;

        // Set the time to current time for accurate day/night
        viewer.clock.currentTime = Cesium.JulianDate.now();
        viewer.clock.shouldAnimate = true;
        viewer.clock.multiplier = 1; // Real-time speed

        // Add moon
        viewer.scene.moon = new Cesium.Moon();

        // Configure sun lighting
        viewer.scene.globe.dynamicAtmosphereLighting = true;
        viewer.scene.globe.dynamicAtmosphereLightingFromSun = true;

        // Add night texture with city lights
        const layers = viewer.scene.imageryLayers;
        const nightLayer = layers.addImageryProvider(
            new Cesium.IonImageryProvider({ assetId: 3812 }) // Earth at Night
        );

        // Make night layer only visible in dark areas
        nightLayer.dayAlpha = 0.0;
        nightLayer.nightAlpha = 1.0;
        nightLayer.brightness = 2.0;

        // Set initial view
        const initialView = {
            destination: Cesium.Cartesian3.fromDegrees(-89.65, 39.8, 15000000),
            orientation: {
                heading: 0.0,
                pitch: -Cesium.Math.PI_OVER_TWO,
                roll: 0.0
            }
        };

        viewer.scene.camera.setView(initialView);

        // Create custom pin billboard with actual logo
        const pinCanvas = document.createElement('canvas');
        pinCanvas.width = 48;
        pinCanvas.height = 64;
        const ctx = pinCanvas.getContext('2d');

        // Function to draw pin with logo
        function drawPinWithLogo(logoImg) {
            // Draw pin shape
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(24, 24, 20, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.moveTo(24, 44);
            ctx.lineTo(14, 24);
            ctx.lineTo(34, 24);
            ctx.closePath();
            ctx.fill();

            // Draw white circle background
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(24, 24, 12, 0, Math.PI * 2);
            ctx.fill();

            // Draw logo image
            if (logoImg) {
                // Scale and center the logo within the white circle
                const logoSize = 35; // Size of logo within the circle
                const logoX = 24 - logoSize / 2;
                const logoY = 24 - logoSize / 2;
                ctx.drawImage(logoImg, logoX, logoY, logoSize, logoSize);
            } else {
                // Fallback to CH text if logo doesn't load
                ctx.fillStyle = '#4A90E2';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('CH', 24, 24);
            }

            return pinCanvas.toDataURL();
        }

        // Load logo and create pins
        const logoImg = new Image();
        logoImg.onload = function () {
            const pinImage = drawPinWithLogo(logoImg);
            addMissionPins(pinImage);
        };
        logoImg.onerror = function () {
            console.warn('Logo failed to load, using fallback');
            const pinImage = drawPinWithLogo(null);
            addMissionPins(pinImage);
        };
        // Update this path to your actual logo file
        logoImg.src = 'assets/logo.svg'; // or 'assets/logo.png'

        // Function to add mission pins
        function addMissionPins(pinImage) {
            missions.forEach((mission) => {
                viewer.entities.add({
                    name: mission.name,
                    position: Cesium.Cartesian3.fromDegrees(mission.lng, mission.lat),
                    billboard: {
                        image: pinImage,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        scale: 1.5,
                        scaleByDistance: new Cesium.NearFarScalar(1.5e2, 1.0, 1.5e7, 0.5)
                    },
                    properties: {
                        mission: mission
                    }
                });
            });
        }

        // Handle mouse events
        const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
        const infoBox = document.getElementById('missionInfoBox');
        const missionNameEl = document.getElementById('missionName');

        // Mouse move for hover effect
        handler.setInputAction(function (movement) {
            const pickedObject = viewer.scene.pick(movement.endPosition);

            if (Cesium.defined(pickedObject) && pickedObject.id && pickedObject.id.properties) {
                const mission = pickedObject.id.properties.mission.getValue();
                missionNameEl.textContent = mission.name;

                infoBox.style.display = 'block';
                infoBox.style.left = movement.endPosition.x + 15 + 'px';
                infoBox.style.top = movement.endPosition.y - 30 + 'px';

                viewer.scene.canvas.style.cursor = 'pointer';
            } else {
                infoBox.style.display = 'none';
                viewer.scene.canvas.style.cursor = 'default';
            }
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);

        // Click handler
        handler.setInputAction(function (click) {
            const pickedObject = viewer.scene.pick(click.position);

            if (Cesium.defined(pickedObject) && pickedObject.id && pickedObject.id.properties) {
                const mission = pickedObject.id.properties.mission.getValue();
                showMissionContent(mission);
            }
        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

        // Home button
        document.getElementById('home-button').addEventListener('click', () => {
            viewer.camera.flyTo({
                destination: Cesium.Cartesian3.fromDegrees(-89.65, 39.8, 15000000),
                orientation: {
                    heading: 0.0,
                    pitch: -Cesium.Math.PI_OVER_TWO,
                    roll: 0.0
                },
                duration: 3.0, // 3 second animation
                easingFunction: Cesium.EasingFunction.CUBIC_IN_OUT
            });
        });

        // Back button
        document.getElementById('back-button').addEventListener('click', () => {
            document.getElementById('content-frame').classList.remove('active');
            resetInactivityTimer();
        });

        // Show mission content
        function showMissionContent(mission) {
            const contentFrame = document.getElementById('content-frame');
            const contentDisplay = document.getElementById('content-display');

            contentFrame.classList.add('active');

            // Simulate loading content (in real app, this would load local HTML)
            contentDisplay.innerHTML = `
                <div style="max-width: 800px; margin: 0 auto; padding: 40px 20px;">
                    <h1 style="color: #333; margin-bottom: 20px;">${mission.name}</h1>
                    <p style="color: #666; line-height: 1.8; margin-bottom: 20px;">
                        This is a placeholder for the missionary information page. In the actual implementation,
                        this would display the locally stored content scraped from: ${mission.url}
                    </p>
                    <div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin-top: 30px;">
                        <h3 style="color: #4A90E2; margin-bottom: 10px;">Location Details</h3>
                        <p><strong>Latitude:</strong> ${mission.lat}</p>
                        <p><strong>Longitude:</strong> ${mission.lng}</p>
                        <p><strong>Source URL:</strong> <a href="${mission.url}" style="color: #4A90E2;">${mission.url}</a></p>
                    </div>
                </div>
            `;

            resetInactivityTimer();
        }

        // Inactivity timer
        let inactivityTimer;

        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                // Return to home with animation
                document.getElementById('content-frame').classList.remove('active');
                viewer.camera.flyTo({
                    destination: Cesium.Cartesian3.fromDegrees(-89.65, 39.8, 15000000),
                    orientation: {
                        heading: 0.0,
                        pitch: -Cesium.Math.PI_OVER_TWO,
                        roll: 0.0
                    },
                    duration: 3.0, // 3 second animation
                    easingFunction: Cesium.EasingFunction.CUBIC_IN_OUT
                });
            }, 600000); // 10 minutes
        }

        // Reset timer on any interaction
        document.addEventListener('click', resetInactivityTimer);
        document.addEventListener('mousemove', resetInactivityTimer);
        document.addEventListener('wheel', resetInactivityTimer);

        // Initial timer
        resetInactivityTimer();

        // Disable double-click zoom
        viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);

        // Set minimum and maximum zoom distances
        viewer.scene.screenSpaceCameraController.minimumZoomDistance = 10000;
        viewer.scene.screenSpaceCameraController.maximumZoomDistance = 30000000;

        // Enable smooth camera movement
        viewer.scene.screenSpaceCameraController.enableTilt = true;
        viewer.scene.screenSpaceCameraController.enableLook = false;
    </script>
</body>

</html>